<!--=======================================================================-->
<!-- include faseunlock                                                    -->
<!--=======================================================================-->
<project name="buildFace" default="compile" basedir=".">
  <property name="face.dir" value="${optional.dir}/faceunlock"/>
  <property name="upd.scr" value="${work.dir}/META-INF/com/google/android/updater-script"/>
  
  <target name="compile" depends="file.faseunlock,update-script" description="execute complete build">
  </target>
  
  <target name="file.faseunlock">
    <copy file="${face.dir}/install-face.sh" todir="${work.dir}/install"/>
    <copy todir="${work.dir}/optional">
      <fileset id="face.file" dir="${face.dir}" excludes="install-face.sh"/>
    </copy>
    <pathconvert refid="face.file" property="file.face.list" pathsep="&#10;">
        <map from="${face.dir}/face/" to=''/>
        <map from="${face.dir}/common/" to=''/>
        <map from="${face.dir}/hammerhead/" to=''/>
        <map from="${face.dir}/manta/" to=''/>
        <map from="${face.dir}/shamu/" to=''/>
        <map from="${face.dir}/tuna/" to=''/>        
    </pathconvert>
    <copy file="${app.dir}/extras/gapps.sh" tofile="${work.dir}/optional/face/addon.d/71-gapps-faceunlock.sh">
    <filterchain>
      <replaceregex pattern="(&lt;&lt;EOF).*" replace="\1&#10;${file.face.list}" flags="i"/>
    </filterchain>
    </copy>
  </target>
  <target name="update-script">
    <property name="opt-rm" value='run_program("/system/addon.d/71-gapps-faceunlock.sh", "remove");'/>
    <property name="opt-install" value='package_extract_dir("optional", "/tmp");&#10;package_extract_file("install/install-face.sh", "/tmp/install-face.sh");&#10;set_perm(0, 0, 0777, "/tmp/install-face.sh");&#10;run_program("/tmp/install-face", "");'/>
    <property name="opt-meta" value='set_metadata_recursive("/system/vendor/pittpatt", "uid", 0, "gid", 0, "dmode", 0755, "fmode", 0644, "capabilities", 0x0, "selabel", "u:object_r:system_file:s0");'/>
    <replaceregexp file="${upd.scr}" match="(#optional-rm).*" replace="\1&#10;${opt-rm}" flags="g" byline="true"/>
    <replaceregexp file="${upd.scr}" match="(#optional-install).*" replace="\1&#10;${opt-install}" flags="g" byline="true"/>
    <replaceregexp file="${upd.scr}" match="(#optional-meta).*" replace="\1&#10;${opt-meta}" flags="g" byline="true"/>
  </target>
</project>