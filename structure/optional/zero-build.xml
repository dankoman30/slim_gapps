<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE project>
  
<!--=======================================================================-->
<!-- zero                                                                  -->
<!--=======================================================================-->
  
<project name="GappsZero" default="compile" basedir=".">

    <import file="${basedir}/build.functions" as="std"/>

    <target name="compile" depends="std.cleanupBefore,buildZero,std.cleanupAfter"
          description="execute zero gapps build">
    </target>
    
    <target name="buildZero">
	   <!-- preparations -->
	   <property environment="env"/>
	   <property name="file.name.zero" value="${build.dir}/Slim_zero_gapps.${PRODUCT_VERSION_MAJOR}.${PRODUCT_VERSION_MINOR}.${PRODUCT_VERSION_MAINTENANCE}-${build.today}.zip"/>
	   
	   <propertyfile file="${build.dir}/gapps.filenames">
	      <entry  key="zerofilename" value="${file.name.zero}"/>
	   </propertyfile>
	   <!-- copy files -->
	    <copy todir="${work.dir}">
	        <fileset dir="${structure.dir}">
	          <include name="META-INF/**" />
	          <include name="backuptool.functions"/>
	          <include name="system/app/ConfigUpdater/**" />
	          <include name="system/app/ExchangeServices/**" />
	          <include name="system/app/GoogleCalendarSyncAdapter/**" />
	          <include name="system/app/GoogleContactsSyncAdapter/**" />
	          <include name="system/etc/**" />
	          <include name="system/framework/**" />
	          <include name="system/lib/**" />
	          <include name="system/priv-app/GoogleBackupTransport/**" />
	          <include name="system/priv-app/GoogleFeedback/**" />
	          <include name="system/priv-app/GoogleLoginService/**" />
	          <include name="system/priv-app/GoogleOneTimeInitializer/**" />
	          <include name="system/priv-app/GooglePartnerSetup/**" />
	          <include name="system/priv-app/GoogleServicesFramework/**" />
	          <include name="system/priv-app/Phonesky/**" />
	          <include name="system/priv-app/PrebuiltGmsCore/**" />
	          <include name="system/priv-app/SetupWizard/**" />
	        </fileset>
	    </copy>
	    <copy file="${basedir}/extras/updater-script" todir="${work.dir}/META-INF/com/google/android"/>
	    <copy file="${basedir}/extras/gapps.sh" tofile="${work.dir}/system/addon.d/80-gapps.sh">
	    <filterchain>
	      <replaceregex pattern="(&lt;&lt;EOF).*" replace="\1&#10;${file.list}" flags="i"/>
	    </filterchain>
	    </copy>
    
      <!-- zip and sign it --> 
	   <antcall target="std.ZipAndSigning">
	        <param name="hfile.name" value="${file.name.zero}"/>
	   </antcall>
    </target> 
</project>